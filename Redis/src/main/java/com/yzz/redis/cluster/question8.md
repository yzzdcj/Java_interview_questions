在企业开发中，我们不会上来就无脑上 Redis Cluster（切片集群），因为维护成本太高。通常是根据业务量级，按照 主从 -> 哨兵 -> 分片集群 的路径演进的。

####【角色设定】：我是你的技术总监。
####【当前阶段】：公司业务飞速发展，我们需要对 Redis 架构进行升级和治理。

请针对以下三个不同阶段的业务场景，完成架构设计和问题排查。

####⚔️ 第一关：主从复制 (Master-Slave) —— 读写分离
####【业务背景】：
    我们的“新闻资讯”模块，读多写少（写 QPS 2000，读 QPS 5万）。
    单机 Redis 的读性能遇到了瓶颈。我们决定搭建 “一主两从” 架构，主节点负责写，从节点负责读。

####【考核题目】：

    架构配置：

    在 Spring Boot (application.yml) 中，配置 Lettuce 客户端以支持读写分离。

    考点：你需要配置 readFrom 参数。请问该参数应该设置为 REPLICA_PREFERRED（优先读从）还是 MASTER_PREFERRED？为什么？

    数据一致性陷阱（核心）：

        运营后台发布了一条新闻（写主库），紧接着立刻去前台刷新（读从库），发现读不到（404）。过了一秒再刷就有了。

        问题：这是什么现象？（主从复制延迟）。

        解决：在代码层面，针对这种“刚写入就要立刻读取”的强一致性业务，你该如何处理？（不能回答“等一秒”，要回答如何路由）。

####请提供：

    Lettuce 读写分离的配置策略说明。

    解决“主从延迟导致读取失败”的业务代码思路。

####🛡️ 第二关：哨兵模式 (Sentinel) —— 高可用故障转移
####【业务背景】：
    我们的“用户会话（Session）”服务，虽然数据量不大（10GB 以内），但对稳定性要求极高。
    如果 Redis 主节点挂了，必须在几十秒内自动选出新主，否则全站用户掉线。我们采用了 Redis Sentinel（哨兵） 架构（3 哨兵 + 1 主 2 从）。

####【考核题目】：

    客户端连接配置：

    在 Spring Boot 中配置哨兵模式时，spring.redis.host 还要填吗？

    考点：你需要填的是哨兵的地址列表，还是 Redis 主节点的地址？

    脑裂问题 (Split-Brain) —— 进阶：

    场景：原主节点（Master A）网络抖动，哨兵以为它挂了，选举了新主（Master B）。但 Master A 其实没死，只是网络卡了，客户端依然在向 Master A 写入数据。

    过了一会 Master A 网络恢复，被降级为 Slave，同步 Master B 的数据。

    后果：Master A 在“假死”期间接收的新数据全部丢失。
    
    解决：请说出 Redis 配置文件 (redis.conf) 中哪两个参数可以限制“如果从节点太少或同步延迟太大，主节点就拒绝写入”？（从而减少数据丢失）。

####请提供：

    Spring Boot 哨兵模式的 YAML 配置片段。

    防止脑裂丢数据的两个 Redis 配置参数名（min-replicas...）。

####🚀 第三关：分片集群 (Cluster) —— 海量数据与 Lua 限制
####【业务背景】：
    我们的“电商购物车”和“优惠券”系统，数据量已突破 200GB，QPS 写请求突破 10 万。
    单机内存和网络带宽都扛不住了。我们上了 Redis Cluster (分片集群)，共 6 个节点（3 主 3 从）。

####【考核题目】：

    Lua 脚本报错 (CROSSSLOT)：

    我们之前写过一个 Lua 脚本，用于原子性地把用户的 A 优惠券（key=coupon:A）换成 B 优惠券（key=coupon:B）。

    在单机模式下跑得好好的，上 Cluster 后直接报错：CROSSSLOT Keys in request don't hash to the same slot。

    原因：A 和 B 两个 Key 被分配到了不同的 Slot（分片节点），Lua 脚本不支持跨节点操作。

    解决：在不修改 Redis 架构的前提下，如何修改 Key 的命名格式，强制让这两个 Key 落到同一个 Slot 中？（Hash Tag 技术）。

    客户端路由原理：

    Java 客户端（Jedis/Lettuce）连接集群时，需要把 6 个节点的 IP 都配上吗？
    
    如果只配了一个节点 A，而客户端想访问的数据在节点 C 上，发生了什么？（MOVED 重定向 概念）。

####请提供：

    解决 CROSSSLOT 问题的 Key 命名示例。

    简述 MOVED 重定向原理。

这三关对应了企业 Redis 演进的三个阶段。请重点回答：

第一关：如何解决主从延迟导致的“写完读不到”？

第二关：哨兵模式下 YAML 怎么写？

第三关：如何用 Hash Tag 解决 Cluster 下的 Lua 脚本问题？